#include "MasterChorus.h"
#include "ak4558.h"

#define __min(a,b) (a<b)?a:b



void WaveGuide_Init(WaveGuide_t *wg)
{
	wg->counter=0;
	for(int s=0;s<MAX_WG_DELAY;s++) wg->buffer[s]=0;
}

int32_t WaveGuide_GetDirect(WaveGuide_t *wg,float Pos)
{
	float back=wg->counter-Pos;

	while (back<0.0) back+=MAX_WG_DELAY;
	while (back>MAX_WG_DELAY) back-=MAX_WG_DELAY;

	int const index0=zOSF2I(floor(back));
	return wg->buffer[index0]<<16;
}

__attribute__( ( section(".data") ) )float InterpolateCubic(float x0, float x1, float x2, float x3, float t)
{
	float a0, a1, a2, a3;
	a0 = x3 - x2 - x0 + x1;
	a1 = x0 - x1 - a0;
	a2 = x2 - x0;
	a3 = x1;
	return (a0 * (t * t * t)) + (a1 * (t * t)) + (a2 * t) + (a3);
}

__attribute__( ( section(".data") ) ) float WaveGuide_Get(WaveGuide_t *wg,float Pos)
{
	float  back=(float)wg->counter-Pos;

	while (back<0.0) back+=MAX_WG_DELAY;
	while (back>MAX_WG_DELAY) back-=MAX_WG_DELAY;

	int const index0=(int)floor(back);


	//int  index_1=index0-1;
	int  index1=index0+1;
	int  index2=index0+2;

	//	if(index_1<0)index_1+=MAX_WG_DELAY;
	if(index1>=MAX_WG_DELAY)
	{
		index1-=MAX_WG_DELAY;
	}
	//if(index2>=MAX_WG_DELAY)
	//	{
	//		index2-=MAX_WG_DELAY;
	//	}

	//float const y_1= wg->buffer [index_1];
	float const y0 = (wg->buffer [index0]);
	float const y1 = (wg->buffer [index1]);
	//float const y2 = wg->buffer [index2];

	float const x=(float)back-(float)index0;
	return y0 + (y1-y0)*x;
	//			float const c0 = y0;
	//		float const c1 = 0.5f*(y1-y_1);
	//	float const c2 = y_1 - 2.5f*y0 + 2.0f*y1 - 0.5f*y2;
	//float const c3 = 0.5f*(y2-y_1) + 1.5f*(y0-y1);
	//return InterpolateCubic(y_1, y0, y1, y2, x);
	//			return ((c3*x+c2)*x+c1)*x+c0;
}

inline void WaveGuide_Push(WaveGuide_t *wg, int32_t in)
{
	wg->buffer[wg->counter]=in>>16;
	wg->counter++;
	if(wg->counter>=MAX_WG_DELAY) wg->counter=0;
}


const float const sintab[2048] = {793.799988, 794.205872, 794.611755, 795.017578, 795.423462, 795.829285, 796.235107, 796.640930, 797.046692, 797.452454, 797.858154, 798.263794, 798.669434, 799.075012, 799.480530, 799.886047, 800.291443, 800.696838, 801.102112, 801.507324, 801.912476, 802.317566, 802.722534, 803.127441, 803.532288, 803.937012, 804.341675, 804.746216, 805.150635, 805.554993, 805.959167, 806.363281, 806.767273, 807.171143, 807.574890, 807.978455, 808.381958, 808.785278, 809.188477, 809.591553, 809.994446, 810.397217, 810.799805, 811.202209, 811.604492, 812.006592, 812.408508, 812.810303, 813.211853, 813.613281, 814.014465, 814.415466, 814.816284, 815.216919, 815.617371, 816.017578, 816.417603, 816.817383, 817.216980, 817.616333, 818.015442, 818.414368, 818.813049, 819.211487, 819.609680, 820.007629, 820.405334, 820.802795, 821.200012, 821.596985, 821.993652, 822.390076, 822.786255, 823.182129, 823.577698, 823.973022, 824.368103, 824.762817, 825.157288, 825.551453, 825.945313, 826.338928, 826.732178, 827.125122, 827.517761, 827.910034, 828.302063, 828.693726, 829.085083, 829.476074, 829.866760, 830.257080, 830.647095, 831.036743, 831.426025, 831.814941, 832.203552, 832.591797, 832.979614, 833.367126, 833.754211, 834.140991, 834.527344, 834.913330, 835.298889, 835.684082, 836.068909, 836.453308, 836.837341, 837.220947, 837.604126, 837.986877, 838.369263, 838.751221, 839.132751, 839.513794, 839.894470, 840.274719, 840.654480, 841.033875, 841.412781, 841.791199, 842.169250, 842.546753, 842.923889, 843.300537, 843.676697, 844.052368, 844.427612, 844.802368, 845.176575, 845.550415, 845.923706, 846.296509, 846.668823, 847.040588, 847.411926, 847.782715, 848.153015, 848.522827, 848.892090, 849.260864, 849.629089, 849.996765, 850.363953, 850.730591, 851.096741, 851.462280, 851.827332, 852.191833, 852.555725, 852.919128, 853.281921, 853.644226, 854.005920, 854.367065, 854.727600, 855.087585, 855.447021, 855.805847, 856.164063, 856.521729, 856.878845, 857.235291, 857.591187, 857.946472, 858.301147, 858.655212, 859.008667, 859.361511, 859.713745, 860.065369, 860.416321, 860.766724, 861.116394, 861.465515, 861.813965, 862.161804, 862.508972, 862.855469, 863.201355, 863.546570, 863.891174, 864.235046, 864.578308, 864.920898, 865.262817, 865.604065, 865.944580, 866.284485, 866.623657, 866.962219, 867.299988, 867.637146, 867.973572, 868.309326, 868.644348, 868.978699, 869.312317, 869.645264, 869.977478, 870.308960, 870.639709, 870.969727, 871.299072, 871.627625, 871.955505, 872.282654, 872.609009, 872.934631, 873.259521, 873.583679, 873.907104, 874.229736, 874.551636, 874.872742, 875.193115, 875.512695, 875.831482, 876.149597, 876.466858, 876.783325, 877.099060, 877.414001, 877.728149, 878.041504, 878.354065, 878.665833, 878.976807, 879.286987, 879.596375, 879.904907, 880.212646, 880.519592, 880.825684, 881.130981, 881.435486, 881.739136, 882.041931, 882.343933, 882.645142, 882.945435, 883.244934, 883.543579, 883.841370, 884.138306, 884.434387, 884.729675, 885.024048, 885.317566, 885.610229, 885.902039, 886.192993, 886.483093, 886.772278, 887.060608, 887.348022, 887.634644, 887.920288, 888.205078, 888.489014, 888.772034, 889.054138, 889.335388, 889.615723, 889.895142, 890.173645, 890.451233, 890.727966, 891.003784, 891.278625, 891.552612, 891.825623, 892.097778, 892.368958, 892.639221, 892.908569, 893.176941, 893.444397, 893.710938, 893.976501, 894.241150, 894.504883, 894.767639, 895.029419, 895.290283, 895.550171, 895.809082, 896.067078, 896.324097, 896.580139, 896.835205, 897.089355, 897.342468, 897.594666, 897.845825, 898.096069, 898.345276, 898.593506, 898.840759, 899.087036, 899.332336, 899.576599, 899.819885, 900.062195, 900.303467, 900.543762, 900.783020, 901.021301, 901.258606, 901.494812, 901.730103, 901.964294, 902.197510, 902.429688, 902.660889, 902.890991, 903.120117, 903.348206, 903.575256, 903.801270, 904.026306, 904.250244, 904.473145, 904.695007, 904.915833, 905.135620, 905.354309, 905.572021, 905.788635, 906.004211, 906.218750, 906.432190, 906.644592, 906.855957, 907.066223, 907.275391, 907.483582, 907.690613, 907.896606, 908.101563, 908.305420, 908.508179, 908.709839, 908.910461, 909.109985, 909.308411, 909.505798, 909.702026, 909.897217, 910.091309, 910.284302, 910.476196, 910.666992, 910.856689, 911.045288, 911.232727, 911.419128, 911.604431, 911.788574, 911.971619, 912.153564, 912.334412, 912.514099, 912.692688, 912.870178, 913.046570, 913.221802, 913.395874, 913.568848, 913.740723, 913.911438, 914.081055, 914.249512, 914.416870, 914.583069, 914.748108, 914.912048, 915.074829, 915.236450, 915.396973, 915.556335, 915.714539, 915.871582, 916.027466, 916.182251, 916.335876, 916.488342, 916.639648, 916.789734, 916.938782, 917.086609, 917.233276, 917.378784, 917.523071, 917.666260, 917.808289, 917.949158, 918.088806, 918.227295, 918.364685, 918.500793, 918.635803, 918.769653, 918.902283, 919.033752, 919.164001, 919.293091, 919.421021, 919.547791, 919.673340, 919.797729, 919.920898, 920.042908, 920.163696, 920.283325, 920.401733, 920.518982, 920.635010, 920.749878, 920.863525, 920.976013, 921.087280, 921.197327, 921.306213, 921.413879, 921.520325, 921.625610, 921.729675, 921.832520, 921.934204, 922.034607, 922.133850, 922.231873, 922.328735, 922.424316, 922.518738, 922.611938, 922.703918, 922.794678, 922.884216, 922.972595, 923.059692, 923.145569, 923.230286, 923.313721, 923.395996, 923.477051, 923.556824, 923.635437, 923.712769, 923.788940, 923.863831, 923.937561, 924.010010, 924.081299, 924.151306, 924.220093, 924.287659, 924.354004, 924.419067, 924.482971, 924.545593, 924.607056, 924.667236, 924.726196, 924.783936, 924.840393, 924.895630, 924.949707, 925.002441, 925.054016, 925.104370, 925.153442, 925.201294, 925.247864, 925.293274, 925.337402, 925.380310, 925.421936, 925.462341, 925.501526, 925.539490, 925.576172, 925.611633, 925.645874, 925.678833, 925.710571, 925.741089, 925.770325, 925.798340, 925.825134, 925.850647, 925.874939, 925.898010, 925.919800, 925.940308, 925.959656, 925.977722, 925.994568, 926.010132, 926.024475, 926.037537, 926.049377, 926.059998, 926.069336, 926.077454, 926.084351, 926.089966, 926.094360, 926.097473, 926.099365, 926.099976, 926.099365, 926.097534, 926.094421, 926.090088, 926.084534, 926.077698, 926.069641, 926.060303, 926.049744, 926.037903, 926.024841, 926.010559, 925.995056, 925.978271, 925.960205, 925.940918, 925.920410, 925.898682, 925.875671, 925.851379, 925.825928, 925.799194, 925.771179, 925.742004, 925.711548, 925.679810, 925.646912, 925.612732, 925.577271, 925.540588, 925.502686, 925.463562, 925.423157, 925.381592, 925.338684, 925.294617, 925.249268, 925.202698, 925.154907, 925.105835, 925.055542, 925.004028, 924.951294, 924.897278, 924.842102, 924.785645, 924.727966, 924.669006, 924.608887, 924.547485, 924.484863, 924.421021, 924.355957, 924.289673, 924.222168, 924.153381, 924.083374, 924.012207, 923.939758, 923.866089, 923.791199, 923.715088, 923.637756, 923.559204, 923.479431, 923.398438, 923.316223, 923.232788, 923.148193, 923.062317, 922.975220, 922.886902, 922.797424, 922.706665, 922.614746, 922.521545, 922.427185, 922.331604, 922.234863, 922.136841, 922.037659, 921.937256, 921.835632, 921.732788, 921.628784, 921.523560, 921.417114, 921.309509, 921.200623, 921.090637, 920.979370, 920.866943, 920.753357, 920.638550, 920.522522, 920.405334, 920.286926, 920.167358, 920.046570, 919.924622, 919.801453, 919.677124, 919.551575, 919.424866, 919.296997, 919.167908, 919.037659, 918.906250, 918.773682, 918.639893, 918.504944, 918.368774, 918.231506, 918.093018, 917.953369, 917.812561, 917.670593, 917.527466, 917.383118, 917.237671, 917.091003, 916.943237, 916.794250, 916.644165, 916.492920, 916.340515, 916.186890, 916.032166, 915.876282, 915.719299, 915.561096, 915.401794, 915.241333, 915.079712, 914.916992, 914.753113, 914.588074, 914.421875, 914.254578, 914.086182, 913.916626, 913.745911, 913.574097, 913.401123, 913.227051, 913.051880, 912.875549, 912.698120, 912.519531, 912.339844, 912.159058, 911.977112, 911.794128, 911.609985, 911.424744, 911.238403, 911.050964, 910.862366, 910.672729, 910.481995, 910.290100, 910.097168, 909.903137, 909.707947, 909.511719, 909.314392, 909.116028, 908.916504, 908.715942, 908.514282, 908.311523, 908.107727, 907.902832, 907.696838, 907.489807, 907.281738, 907.072571, 906.862305, 906.651001, 906.438660, 906.225220, 906.010742, 905.795166, 905.578552, 905.360901, 905.142212, 904.922485, 904.701660, 904.479858, 904.256958, 904.033020, 903.808105, 903.582092, 903.355103, 903.127014, 902.897949, 902.667847, 902.436707, 902.204529, 901.971375, 901.737183, 901.501953, 901.265747, 901.028503, 900.790222, 900.551025, 900.310730, 900.069519, 899.827209, 899.583984, 899.339722, 899.094482, 898.848206, 898.601013, 898.352783, 898.103577, 897.853394, 897.602234, 897.350098, 897.096985, 896.842896, 896.587830, 896.331848, 896.074829, 895.816895, 895.557983, 895.298157, 895.037354, 894.775574, 894.512817, 894.249146, 893.984558, 893.718994, 893.452454, 893.185059, 892.916687, 892.647339, 892.377136, 892.105957, 891.833862, 891.560852, 891.286926, 891.012085, 890.736328, 890.459656, 890.182068, 889.903564, 889.624146, 889.343872, 889.062622, 888.780518, 888.497559, 888.213684, 887.928894, 887.643250, 887.356750, 887.069275, 886.781006, 886.491821, 886.201782, 885.910889, 885.619080, 885.326416, 885.032959, 884.738586, 884.443359, 884.147278, 883.850342, 883.552551, 883.253967, 882.954529, 882.654175, 882.353088, 882.051086, 881.748291, 881.444641, 881.140198, 880.834961, 880.528870, 880.221924, 879.914246, 879.605652, 879.296326, 878.986206, 878.675232, 878.363525, 878.050964, 877.737610, 877.423523, 877.108582, 876.792908, 876.476379, 876.159180, 875.841125, 875.522339, 875.202759, 874.882446, 874.561340, 874.239441, 873.916870, 873.593445, 873.269348, 872.944458, 872.618835, 872.292480, 871.965393, 871.637573, 871.309021, 870.979736, 870.649658, 870.318909, 869.987488, 869.655273, 869.322388, 868.988770, 868.654480, 868.319458, 867.983765, 867.647339, 867.310181, 866.972412, 866.633911, 866.294739, 865.954895, 865.614319, 865.273132, 864.931213, 864.588684, 864.245422, 863.901550, 863.557007, 863.211792, 862.865967, 862.519470, 862.172302, 861.824524, 861.476074, 861.127014, 860.777283, 860.426941, 860.075989, 859.724365, 859.372192, 859.019348, 858.665894, 858.311829, 857.957153, 857.601929, 857.246033, 856.889587, 856.532532, 856.174866, 855.816650, 855.457825, 855.098450, 854.738464, 854.377930, 854.016846, 853.655151, 853.292908, 852.930054, 852.566711, 852.202820, 851.838318, 851.473328, 851.107788, 850.741699, 850.375061, 850.007874, 849.640198, 849.271973, 848.903259, 848.533997, 848.164246, 847.793945, 847.423096, 847.051819, 846.680054, 846.307739, 845.934937, 845.561707, 845.187927, 844.813660, 844.438904, 844.063721, 843.688049, 843.311890, 842.935242, 842.558167, 842.180603, 841.802673, 841.424194, 841.045288, 840.665955, 840.286194, 839.906006, 839.525330, 839.144226, 838.762756, 838.380798, 837.998474, 837.615662, 837.232483, 836.848877, 836.464905, 836.080505, 835.695740, 835.310547, 834.924988, 834.539001, 834.152649, 833.765930, 833.378845, 832.991333, 832.603516, 832.215271, 831.826721, 831.437805, 831.048462, 830.658875, 830.268860, 829.878540, 829.487915, 829.096863, 828.705566, 828.313904, 827.921936, 827.529602, 827.136963, 826.744019, 826.350769, 825.957214, 825.563354, 825.169250, 824.774780, 824.380005, 823.984985, 823.589661, 823.194092, 822.798218, 822.402039, 822.005615, 821.608948, 821.212036, 820.814819, 820.417358, 820.019653, 819.621704, 819.223511, 818.825073, 818.426453, 818.027527, 817.628357, 817.229004, 816.829468, 816.429688, 816.029663, 815.629456, 815.229004, 814.828369, 814.427612, 814.026550, 813.625366, 813.223999, 812.822388, 812.420654, 812.018738, 811.616638, 811.214355, 810.811951, 810.409363, 810.006592, 809.603699, 809.200684, 808.797485, 808.394165, 807.990662, 807.587097, 807.183350, 806.779480, 806.375488, 805.971436, 805.567200, 805.162842, 804.758423, 804.353882, 803.949280, 803.544495, 803.139709, 802.734802, 802.329773, 801.924744, 801.519592, 801.114380, 800.709045, 800.303711, 799.898254, 799.492798, 799.087280, 798.681702, 798.276062, 797.870422, 797.464661, 797.058960, 796.653198, 796.247375, 795.841553, 795.435730, 795.029846, 794.624023, 794.218140, 793.812256, 793.406372, 793.000488, 792.594604, 792.188782, 791.782898, 791.377075, 790.971313, 790.565552, 790.159790, 789.754089, 789.348450, 788.942810, 788.537170, 788.131653, 787.726196, 787.320801, 786.915405, 786.510071, 786.104858, 785.699707, 785.294678, 784.889648, 784.484741, 784.079895, 783.675171, 783.270508, 782.865967, 782.461548, 782.057190, 781.652954, 781.248901, 780.844910, 780.441040, 780.037292, 779.633667, 779.230225, 778.826843, 778.423645, 778.020569, 777.617737, 777.214966, 776.812317, 776.409912, 776.007629, 775.605530, 775.203552, 774.801819, 774.400269, 773.998840, 773.597656, 773.196594, 772.795776, 772.395142, 771.994690, 771.594482, 771.194458, 770.794678, 770.395081, 769.995728, 769.596558, 769.197632, 768.798950, 768.400513, 768.002319, 767.604370, 767.206604, 766.809143, 766.411926, 766.015015, 765.618286, 765.221863, 764.825684, 764.429810, 764.034180, 763.638855, 763.243835, 762.849060, 762.454590, 762.060425, 761.666504, 761.272949, 760.879700, 760.486755, 760.094116, 759.701721, 759.309753, 758.918091, 758.526733, 758.135681, 757.744995, 757.354675, 756.964661, 756.575012, 756.185669, 755.796753, 755.408142, 755.019897, 754.632080, 754.244568, 753.857422, 753.470703, 753.084290, 752.698303, 752.312683, 751.927490, 751.542664, 751.158264, 750.774231, 750.390625, 750.007446, 749.624634, 749.242249, 748.860291, 748.478760, 748.097656, 747.716980, 747.336731, 746.956909, 746.577576, 746.198669, 745.820190, 745.442139, 745.064575, 744.687500, 744.310852, 743.934631, 743.558960, 743.183716, 742.808960, 742.434692, 742.060852, 741.687561, 741.314758, 740.942444, 740.570557, 740.199280, 739.828430, 739.458130, 739.088318, 738.718994, 738.350281, 737.981995, 737.614258, 737.247070, 736.880432, 736.514282, 736.148682, 735.783691, 735.419189, 735.055237, 734.691833, 734.328979, 733.966736, 733.604980, 733.243835, 732.883240, 732.523254, 732.163818, 731.804932, 731.446716, 731.088989, 730.731934, 730.375427, 730.019531, 729.664246, 729.309509, 728.955444, 728.601990, 728.249084, 727.896851, 727.545227, 727.194214, 726.843872, 726.494080, 726.145020, 725.796509, 725.448669, 725.101501, 724.754944, 724.409058, 724.063782, 723.719238, 723.375305, 723.032043, 722.689392, 722.347473, 722.006226, 721.665649, 721.325745, 720.986511, 720.648010, 720.310181, 719.972961, 719.636536, 719.300781, 718.965698, 718.631348, 718.297668, 717.964783, 717.632507, 717.301025, 716.970276, 716.640198, 716.310852, 715.982239, 715.654358, 715.327209, 715.000854, 714.675171, 714.350220, 714.026062, 713.702637, 713.380005, 713.058105, 712.736938, 712.416565, 712.096924, 711.778076, 711.460022, 711.142700, 710.826172, 710.510437, 710.195496, 709.881287, 709.567932, 709.255310, 708.943542, 708.632568, 708.322327, 708.012939, 707.704346, 707.396606, 707.089661, 706.783508, 706.478210, 706.173645, 705.869995, 705.567139, 705.265137, 704.963928, 704.663574, 704.364075, 704.065430, 703.767578, 703.470642, 703.174500, 702.879211, 702.584778, 702.291260, 701.998535, 701.706726, 701.415771, 701.125610, 700.836426, 700.548096, 700.260559, 699.973999, 699.688293, 699.403503, 699.119507, 698.836487, 698.554321, 698.273071, 697.992737, 697.713257, 697.434753, 697.157104, 696.880371, 696.604553, 696.329651, 696.055664, 695.782593, 695.510437, 695.239197, 694.968933, 694.699524, 694.431091, 694.163635, 693.897095, 693.631470, 693.366760, 693.103088, 692.840271, 692.578430, 692.317566, 692.057617, 691.798706, 691.540649, 691.283630, 691.027527, 690.772461, 690.518311, 690.265137, 690.012939, 689.761719, 689.511475, 689.262207, 689.013916, 688.766663, 688.520325, 688.275085, 688.030762, 687.787415, 687.545105, 687.303772, 687.063477, 686.824158, 686.585815, 686.348511, 686.112244, 685.877014, 685.642700, 685.409485, 685.177246, 684.946106, 684.715881, 684.486755, 684.258606, 684.031555, 683.805481, 683.580505, 683.356506, 683.133545, 682.911621, 682.690796, 682.471008, 682.252258, 682.034485, 681.817871, 681.602234, 681.387695, 681.174194, 680.961792, 680.750366, 680.540100, 680.330872, 680.122681, 679.915588, 679.709595, 679.504578, 679.300720, 679.097900, 678.896179, 678.695557, 678.495972, 678.297546, 678.100098, 677.903809, 677.708618, 677.514526, 677.321472, 677.129578, 676.938721, 676.749023, 676.560425, 676.372864, 676.186462, 676.001160, 675.816956, 675.633850, 675.451904, 675.270996, 675.091309, 674.912659, 674.735107, 674.558716, 674.383484, 674.209351, 674.036316, 673.864441, 673.693665, 673.523987, 673.355530, 673.188171, 673.021912, 672.856812, 672.692871, 672.530090, 672.368408, 672.207825, 672.048462, 671.890198, 671.733154, 671.577148, 671.422363, 671.268738, 671.116211, 670.964905, 670.814758, 670.665710, 670.517822, 670.371155, 670.225586, 670.081238, 669.937988, 669.795959, 669.655090, 669.515381, 669.376831, 669.239441, 669.103210, 668.968262, 668.834351, 668.701721, 668.570190, 668.439880, 668.310730, 668.182800, 668.056030, 667.930420, 667.806030, 667.682800, 667.560730, 667.439880, 667.320251, 667.201782, 667.084534, 666.968445, 666.853516, 666.739807, 666.627380, 666.516052, 666.405945, 666.297058, 666.189331, 666.082825, 665.977539, 665.873413, 665.770508, 665.668823, 665.568359, 665.469116, 665.371033, 665.274170, 665.178528, 665.084045, 664.990845, 664.898804, 664.808044, 664.718445, 664.630066, 664.542908, 664.456970, 664.372253, 664.288757, 664.206421, 664.125366, 664.045532, 663.966919, 663.889526, 663.813293, 663.738342, 663.664612, 663.592102, 663.520874, 663.450806, 663.381958, 663.314331, 663.247986, 663.182861, 663.118896, 663.056213, 662.994751, 662.934570, 662.875549, 662.817810, 662.761292, 662.705994, 662.651917, 662.599060, 662.547485, 662.497131, 662.447998, 662.400146, 662.353455, 662.308044, 662.263916, 662.220947, 662.179260, 662.138794, 662.099609, 662.061584, 662.024902, 661.989380, 661.955139, 661.922119, 661.890320, 661.859802, 661.830505, 661.802429, 661.775635, 661.750061, 661.725769, 661.702698, 661.680847, 661.660217, 661.640869, 661.622803, 661.605896, 661.590332, 661.575928, 661.562805, 661.550903, 661.540283, 661.530884, 661.522766, 661.515808, 661.510193, 661.505737, 661.502563, 661.500671, 661.500000, 661.500549, 661.502380, 661.505432, 661.509705, 661.515259, 661.522034, 661.530090, 661.539368, 661.549927, 661.561646, 661.574707, 661.588928, 661.604431, 661.621216, 661.639221, 661.658447, 661.678894, 661.700623, 661.723633, 661.747803, 661.773254, 661.799988, 661.827881, 661.857117, 661.887512, 661.919189, 661.952087, 661.986206, 662.021606, 662.058228, 662.096130, 662.135193, 662.175537, 662.217163, 662.259949, 662.304016, 662.349304, 662.395874, 662.443604, 662.492615, 662.542908, 662.594360, 662.647095, 662.700989, 662.756226, 662.812622, 662.870300, 662.929138, 662.989258, 663.050598, 663.113159, 663.177002, 663.242004, 663.308289, 663.375793, 663.444519, 663.514465, 663.585632, 663.658020, 663.731628, 663.806458, 663.882568, 663.959839, 664.038330, 664.118103, 664.199036, 664.281250, 664.364624, 664.449219, 664.535095, 664.622131, 664.710388, 664.799866, 664.890564, 664.982483, 665.075562, 665.169922, 665.265442, 665.362183, 665.460144, 665.559326, 665.659668, 665.761292, 665.864075, 665.968079, 666.073242, 666.179626, 666.287231, 666.395996, 666.506042, 666.617249, 666.729614, 666.843201, 666.957947, 667.073975, 667.191101, 667.309448, 667.429016, 667.549744, 667.671692, 667.794800, 667.919067, 668.044556, 668.171265, 668.299133, 668.428101, 668.558350, 668.689758, 668.822327, 668.956055, 669.090942, 669.227051, 669.364319, 669.502747, 669.642395, 669.783142, 669.925110, 670.068176, 670.212463, 670.357910, 670.504517, 670.652283, 670.801208, 670.951233, 671.102478, 671.254883, 671.408386, 671.563110, 671.718933, 671.875916, 672.034058, 672.193359, 672.353760, 672.515381, 672.678040, 672.841919, 673.006897, 673.173035, 673.340332, 673.508667, 673.678223, 673.848877, 674.020691, 674.193604, 674.367615, 674.542786, 674.719116, 674.896545, 675.075073, 675.254700, 675.435425, 675.617310, 675.800354, 675.984375, 676.169617, 676.355957, 676.543335, 676.731873, 676.921509, 677.112244, 677.304077, 677.497009, 677.690979, 677.886108, 678.082275, 678.279602, 678.477966, 678.677429, 678.877930, 679.079590, 679.282288, 679.486084, 679.690979, 679.896851, 680.103882, 680.311951, 680.521118, 680.731262, 680.942566, 681.154907, 681.368347, 681.582764, 681.798279, 682.014832, 682.232483, 682.451111, 682.670837, 682.891602, 683.113403, 683.336243, 683.560120, 683.785095, 684.010986, 684.238037, 684.466064, 684.695129, 684.925171, 685.156250, 685.388428, 685.621582, 685.855713, 686.090881, 686.327087, 686.564270, 686.802490, 687.041748, 687.281921, 687.523193, 687.765442, 688.008667, 688.252869, 688.498108, 688.744324, 688.991516, 689.239685, 689.488892, 689.739014, 689.990112, 690.242249, 690.495300, 690.749390, 691.004395, 691.260376, 691.517334, 691.775269, 692.034119, 692.293945, 692.554749, 692.816528, 693.079224, 693.342834, 693.607422, 693.872986, 694.139465, 694.406860, 694.675171, 694.944458, 695.214661, 695.485840, 695.757874, 696.030823, 696.304749, 696.579590, 696.855347, 697.132019, 697.409546, 697.687988, 697.967346, 698.247681, 698.528809, 698.810852, 699.093872, 699.377686, 699.662476, 699.948059, 700.234558, 700.521973, 700.810242, 701.099426, 701.389404, 701.680298, 701.972046, 702.264709, 702.558167, 702.852478, 703.147705, 703.443726, 703.740662, 704.038391, 704.336975, 704.636414, 704.936707, 705.237793, 705.539795, 705.842529, 706.146118, 706.450562, 706.755798, 707.061829, 707.368774, 707.676453, 707.984985, 708.294312, 708.604370, 708.915344, 709.227051, 709.539551, 709.852905, 710.166931, 710.481873, 710.797546, 711.114014, 711.431274, 711.749207, 712.067993, 712.387573, 712.707886, 713.028992, 713.350769, 713.673401, 713.996765, 714.320862, 714.645630, 714.971252, 715.297607, 715.624695, 715.952515, 716.281006, 716.610291, 716.940308, 717.271057, 717.602478, 717.934631, 718.267517, 718.601074, 718.935425, 719.270386, 719.606079, 719.942444, 720.279602, 720.617371, 720.955872, 721.294983, 721.634827, 721.975342, 722.316589, 722.658386, 723.000916, 723.344177, 723.688049, 724.032593, 724.377686, 724.723572, 725.070068, 725.417175, 725.765015, 726.113342, 726.462463, 726.812134, 727.162476, 727.513428, 727.864929, 728.217163, 728.570007, 728.923401, 729.277466, 729.632080, 729.987305, 730.343140, 730.699646, 731.056641, 731.414246, 731.772461, 732.131287, 732.490662, 732.850586, 733.211121, 733.572266, 733.933899, 734.296143, 734.658875, 735.022278, 735.386169, 735.750610, 736.115662, 736.481140, 736.847229, 737.213867, 737.580994, 737.948669, 738.316833, 738.685608, 739.054810, 739.424622, 739.794800, 740.165649, 740.536926, 740.908691, 741.281006, 741.653748, 742.027039, 742.400757, 742.775024, 743.149780, 743.524902, 743.900574, 744.276733, 744.653320, 745.030457, 745.407898, 745.785889, 746.164368, 746.543213, 746.922546, 747.302307, 747.682495, 748.063171, 748.444214, 748.825745, 749.207642, 749.589966, 749.972717, 750.355896, 750.739441, 751.123413, 751.507813, 751.892639, 752.277832, 752.663330, 753.049316, 753.435669, 753.822388, 754.209473, 754.596924, 754.984741, 755.372986, 755.761536, 756.150452, 756.539673, 756.929321, 757.319336, 757.709656, 758.100342, 758.491272, 758.882568, 759.274231, 759.666260, 760.058472, 760.451111, 760.844055, 761.237305, 761.630859, 762.024658, 762.418823, 762.813293, 763.208069, 763.603088, 763.998352, 764.393921, 764.789795, 765.185974, 765.582397, 765.979004, 766.375977, 766.773132, 767.170593, 767.568359, 767.966248, 768.364441, 768.762878, 769.161560, 769.560364, 769.959534, 770.358887, 770.758484, 771.158264, 771.558228, 771.958435, 772.358826, 772.759460, 773.160278, 773.561279, 773.962463, 774.363892, 774.765442, 775.167175, 775.569092, 775.971191, 776.373474, 776.775879, 777.178467, 777.581177, 777.984070, 778.387146, 778.790344, 779.193604, 779.597107, 780.000732, 780.404480, 780.808350, 781.212280, 781.616333, 782.020569, 782.424927, 782.829346, 783.233826, 783.638489, 784.043213, 784.448059, 784.852966, 785.257935, 785.663025, 786.068176, 786.473389, 786.878723, 787.283997, 787.689453, 788.094910, 788.500488, 788.906006, 789.311646, 789.717346, 790.123047, 790.528809, 790.934509, 791.340332, 791.746155, 792.151978, 792.557861, 792.963684, 793.369568};

const float const dsintab[2048] = {0.405884, 0.405884, 0.405823, 0.405884, 0.405823, 0.405823, 0.405823, 0.405762, 0.405762, 0.405701, 0.405640, 0.405640, 0.405579, 0.405518, 0.405518, 0.405396, 0.405396, 0.405273, 0.405212, 0.405151, 0.405090, 0.404968, 0.404907, 0.404846, 0.404724, 0.404663, 0.404541, 0.404419, 0.404358, 0.404175, 0.404114, 0.403992, 0.403870, 0.403748, 0.403564, 0.403503, 0.403320, 0.403198, 0.403076, 0.402893, 0.402771, 0.402588, 0.402405, 0.402283, 0.402100, 0.401917, 0.401794, 0.401550, 0.401428, 0.401184, 0.401001, 0.400818, 0.400635, 0.400452, 0.400208, 0.400024, 0.399780, 0.399597, 0.399353, 0.399109, 0.398926, 0.398682, 0.398438, 0.398193, 0.397949, 0.397705, 0.397461, 0.397217, 0.396973, 0.396667, 0.396423, 0.396179, 0.395874, 0.395569, 0.395325, 0.395081, 0.394714, 0.394470, 0.394165, 0.393860, 0.393616, 0.393250, 0.392944, 0.392639, 0.392273, 0.392029, 0.391663, 0.391357, 0.390991, 0.390686, 0.390320, 0.390015, 0.389648, 0.389282, 0.388916, 0.388611, 0.388245, 0.387817, 0.387512, 0.387085, 0.386780, 0.386353, 0.385986, 0.385559, 0.385193, 0.384827, 0.384399, 0.384033, 0.383606, 0.383179, 0.382751, 0.382385, 0.381958, 0.381531, 0.381042, 0.380676, 0.380249, 0.379761, 0.379395, 0.378906, 0.378418, 0.378052, 0.377502, 0.377136, 0.376648, 0.376160, 0.375671, 0.375244, 0.374756, 0.374207, 0.373840, 0.373291, 0.372803, 0.372314, 0.371765, 0.371338, 0.370789, 0.370300, 0.369812, 0.369263, 0.368774, 0.368225, 0.367676, 0.367188, 0.366638, 0.366150, 0.365540, 0.365051, 0.364502, 0.363892, 0.363403, 0.362793, 0.362305, 0.361694, 0.361145, 0.360535, 0.359985, 0.359436, 0.358826, 0.358215, 0.357666, 0.357117, 0.356445, 0.355896, 0.355286, 0.354675, 0.354065, 0.353455, 0.352844, 0.352234, 0.351624, 0.350952, 0.350403, 0.349670, 0.349121, 0.348450, 0.347839, 0.347168, 0.346497, 0.345886, 0.345215, 0.344604, 0.343872, 0.343262, 0.342590, 0.341919, 0.341248, 0.340515, 0.339905, 0.339172, 0.338562, 0.337769, 0.337158, 0.336426, 0.335754, 0.335022, 0.334351, 0.333618, 0.332947, 0.332214, 0.331482, 0.330750, 0.330017, 0.329346, 0.328552, 0.327881, 0.327148, 0.326355, 0.325623, 0.324890, 0.324158, 0.323425, 0.322632, 0.321899, 0.321106, 0.320374, 0.319580, 0.318787, 0.318115, 0.317261, 0.316467, 0.315735, 0.314941, 0.314148, 0.313354, 0.312561, 0.311768, 0.310974, 0.310181, 0.309387, 0.308533, 0.307739, 0.306946, 0.306091, 0.305298, 0.304504, 0.303650, 0.302795, 0.302002, 0.301208, 0.300293, 0.299500, 0.298645, 0.297791, 0.296936, 0.296082, 0.295288, 0.294373, 0.293518, 0.292664, 0.291809, 0.290955, 0.290100, 0.289185, 0.288330, 0.287415, 0.286621, 0.285645, 0.284790, 0.283936, 0.283020, 0.282104, 0.281250, 0.280334, 0.279419, 0.278503, 0.277588, 0.276733, 0.275818, 0.274841, 0.273987, 0.273010, 0.272156, 0.271179, 0.270264, 0.269348, 0.268372, 0.267456, 0.266541, 0.265564, 0.264648, 0.263733, 0.262756, 0.261780, 0.260864, 0.259888, 0.258911, 0.257996, 0.257019, 0.256042, 0.255066, 0.254150, 0.253113, 0.252197, 0.251160, 0.250244, 0.249207, 0.248230, 0.247253, 0.246277, 0.245300, 0.244263, 0.243286, 0.242310, 0.241272, 0.240295, 0.239258, 0.238281, 0.237305, 0.236206, 0.235291, 0.234192, 0.233215, 0.232178, 0.231201, 0.230103, 0.229126, 0.228088, 0.227051, 0.226013, 0.225037, 0.223938, 0.222900, 0.221863, 0.220825, 0.219788, 0.218689, 0.217712, 0.216614, 0.215576, 0.214539, 0.213440, 0.212402, 0.211365, 0.210266, 0.209167, 0.208191, 0.207031, 0.205994, 0.204956, 0.203857, 0.202759, 0.201660, 0.200623, 0.199524, 0.198425, 0.197388, 0.196228, 0.195190, 0.194092, 0.192993, 0.191895, 0.190796, 0.189697, 0.188599, 0.187439, 0.186401, 0.185303, 0.184143, 0.183044, 0.181946, 0.180847, 0.179688, 0.178589, 0.177490, 0.176392, 0.175232, 0.174072, 0.172974, 0.171875, 0.170715, 0.169617, 0.168457, 0.167358, 0.166199, 0.165039, 0.163940, 0.162781, 0.161621, 0.160522, 0.159363, 0.158203, 0.157043, 0.155884, 0.154785, 0.153625, 0.152466, 0.151306, 0.150085, 0.149048, 0.147827, 0.146667, 0.145508, 0.144287, 0.143188, 0.142029, 0.140869, 0.139648, 0.138489, 0.137390, 0.136108, 0.135010, 0.133850, 0.132629, 0.131470, 0.130249, 0.129089, 0.127930, 0.126770, 0.125549, 0.124390, 0.123169, 0.122009, 0.120789, 0.119629, 0.118408, 0.117249, 0.116028, 0.114868, 0.113647, 0.112488, 0.111267, 0.110046, 0.108887, 0.107666, 0.106445, 0.105286, 0.104065, 0.102844, 0.101685, 0.100403, 0.099243, 0.098022, 0.096863, 0.095581, 0.094421, 0.093201, 0.091980, 0.090759, 0.089539, 0.088379, 0.087097, 0.085876, 0.084717, 0.083435, 0.082275, 0.081055, 0.079773, 0.078613, 0.077332, 0.076172, 0.074890, 0.073730, 0.072449, 0.071289, 0.070007, 0.068787, 0.067566, 0.066345, 0.065063, 0.063904, 0.062622, 0.061462, 0.060181, 0.058960, 0.057739, 0.056458, 0.055237, 0.054077, 0.052734, 0.051575, 0.050354, 0.049072, 0.047852, 0.046570, 0.045410, 0.044128, 0.042908, 0.041626, 0.040405, 0.039185, 0.037964, 0.036682, 0.035461, 0.034241, 0.032959, 0.031738, 0.030518, 0.029236, 0.028015, 0.026794, 0.025513, 0.024292, 0.023071, 0.021790, 0.020508, 0.019348, 0.018066, 0.016846, 0.015564, 0.014343, 0.013062, 0.011841, 0.010620, 0.009338, 0.008118, 0.006897, 0.005615, 0.004395, 0.003113, 0.001892, 0.000610, -0.000610, -0.001831, -0.003113, -0.004333, -0.005554, -0.006836, -0.008057, -0.009338, -0.010559, -0.011841, -0.013062, -0.014282, -0.015503, -0.016785, -0.018066, -0.019287, -0.020508, -0.021729, -0.023010, -0.024292, -0.025452, -0.026733, -0.028015, -0.029175, -0.030457, -0.031738, -0.032898, -0.034180, -0.035461, -0.036682, -0.037903, -0.039124, -0.040405, -0.041565, -0.042908, -0.044067, -0.045349, -0.046570, -0.047791, -0.049072, -0.050293, -0.051514, -0.052734, -0.054016, -0.055176, -0.056458, -0.057678, -0.058960, -0.060120, -0.061401, -0.062622, -0.063843, -0.065063, -0.066284, -0.067505, -0.068787, -0.070007, -0.071167, -0.072449, -0.073669, -0.074890, -0.076111, -0.077332, -0.078552, -0.079773, -0.080994, -0.082214, -0.083435, -0.084595, -0.085876, -0.087097, -0.088318, -0.089478, -0.090759, -0.091919, -0.093201, -0.094360, -0.095581, -0.096741, -0.098022, -0.099182, -0.100403, -0.101624, -0.102844, -0.104004, -0.105225, -0.106445, -0.107605, -0.108887, -0.109985, -0.111267, -0.112427, -0.113586, -0.114807, -0.116028, -0.117188, -0.118408, -0.119568, -0.120789, -0.121948, -0.123169, -0.124329, -0.125549, -0.126709, -0.127869, -0.129089, -0.130249, -0.131409, -0.132568, -0.133789, -0.134949, -0.136169, -0.137268, -0.138489, -0.139648, -0.140808, -0.141968, -0.143127, -0.144348, -0.145447, -0.146667, -0.147766, -0.148987, -0.150085, -0.151245, -0.152405, -0.153625, -0.154724, -0.155884, -0.156982, -0.158203, -0.159302, -0.160461, -0.161621, -0.162720, -0.163879, -0.165039, -0.166199, -0.167297, -0.168396, -0.169556, -0.170715, -0.171814, -0.172974, -0.174072, -0.175171, -0.176331, -0.177429, -0.178589, -0.179688, -0.180786, -0.181946, -0.182983, -0.184143, -0.185242, -0.186340, -0.187439, -0.188599, -0.189636, -0.190735, -0.191895, -0.192932, -0.194031, -0.195190, -0.196228, -0.197327, -0.198364, -0.199524, -0.200562, -0.201660, -0.202759, -0.203796, -0.204895, -0.205994, -0.207031, -0.208069, -0.209167, -0.210266, -0.211304, -0.212341, -0.213440, -0.214478, -0.215576, -0.216614, -0.217651, -0.218689, -0.219727, -0.220825, -0.221802, -0.222900, -0.223938, -0.224915, -0.226013, -0.226990, -0.228088, -0.229065, -0.230103, -0.231140, -0.232178, -0.233154, -0.234192, -0.235229, -0.236206, -0.237244, -0.238281, -0.239197, -0.240295, -0.241211, -0.242310, -0.243225, -0.244263, -0.245239, -0.246277, -0.247192, -0.248230, -0.249207, -0.250183, -0.251160, -0.252136, -0.253113, -0.254089, -0.255066, -0.255981, -0.257019, -0.257935, -0.258911, -0.259827, -0.260803, -0.261780, -0.262756, -0.263672, -0.264587, -0.265564, -0.266541, -0.267395, -0.268372, -0.269348, -0.270203, -0.271179, -0.272095, -0.273010, -0.273926, -0.274841, -0.275757, -0.276672, -0.277588, -0.278503, -0.279419, -0.280273, -0.281250, -0.282104, -0.282959, -0.283875, -0.284790, -0.285645, -0.286499, -0.287476, -0.288269, -0.289185, -0.290039, -0.290894, -0.291809, -0.292664, -0.293457, -0.294373, -0.295227, -0.296082, -0.296936, -0.297791, -0.298584, -0.299438, -0.300354, -0.301086, -0.302002, -0.302795, -0.303650, -0.304443, -0.305237, -0.306091, -0.306946, -0.307678, -0.308594, -0.309326, -0.310120, -0.310974, -0.311707, -0.312561, -0.313354, -0.314087, -0.314941, -0.315674, -0.316528, -0.317200, -0.318054, -0.318787, -0.319580, -0.320313, -0.321106, -0.321899, -0.322571, -0.323425, -0.324097, -0.324890, -0.325623, -0.326355, -0.327087, -0.327820, -0.328552, -0.329285, -0.330078, -0.330750, -0.331421, -0.332214, -0.332886, -0.333618, -0.334290, -0.335022, -0.335693, -0.336426, -0.337158, -0.337769, -0.338501, -0.339172, -0.339844, -0.340576, -0.341187, -0.341919, -0.342529, -0.343262, -0.343872, -0.344543, -0.345215, -0.345825, -0.346497, -0.347168, -0.347778, -0.348450, -0.349060, -0.349731, -0.350342, -0.350952, -0.351624, -0.352173, -0.352844, -0.353455, -0.354065, -0.354675, -0.355225, -0.355896, -0.356445, -0.357056, -0.357666, -0.358215, -0.358826, -0.359375, -0.359985, -0.360535, -0.361084, -0.361694, -0.362244, -0.362854, -0.363342, -0.363892, -0.364502, -0.364990, -0.365540, -0.366089, -0.366638, -0.367188, -0.367676, -0.368225, -0.368713, -0.369263, -0.369751, -0.370300, -0.370850, -0.371277, -0.371765, -0.372314, -0.372803, -0.373230, -0.373779, -0.374268, -0.374756, -0.375183, -0.375671, -0.376160, -0.376648, -0.377075, -0.377563, -0.377930, -0.378479, -0.378906, -0.379333, -0.379761, -0.380188, -0.380676, -0.381104, -0.381470, -0.381958, -0.382324, -0.382813, -0.383179, -0.383606, -0.383972, -0.384399, -0.384766, -0.385193, -0.385559, -0.385986, -0.386353, -0.386719, -0.387085, -0.387512, -0.387817, -0.388245, -0.388550, -0.388916, -0.389343, -0.389587, -0.390015, -0.390320, -0.390625, -0.391052, -0.391296, -0.391663, -0.391968, -0.392334, -0.392639, -0.392944, -0.393250, -0.393555, -0.393860, -0.394104, -0.394470, -0.394775, -0.395020, -0.395325, -0.395569, -0.395874, -0.396179, -0.396423, -0.396667, -0.396912, -0.397217, -0.397461, -0.397705, -0.397949, -0.398193, -0.398438, -0.398621, -0.398926, -0.399170, -0.399353, -0.399536, -0.399780, -0.400024, -0.400208, -0.400452, -0.400635, -0.400757, -0.401062, -0.401184, -0.401367, -0.401611, -0.401733, -0.401917, -0.402100, -0.402283, -0.402405, -0.402588, -0.402771, -0.402893, -0.403015, -0.403198, -0.403320, -0.403503, -0.403564, -0.403748, -0.403870, -0.403992, -0.404053, -0.404236, -0.404358, -0.404419, -0.404541, -0.404602, -0.404785, -0.404785, -0.404907, -0.405029, -0.405029, -0.405151, -0.405212, -0.405334, -0.405334, -0.405457, -0.405457, -0.405518, -0.405579, -0.405640, -0.405640, -0.405762, -0.405701, -0.405762, -0.405823, -0.405823, -0.405823, -0.405884, -0.405823, -0.405884, -0.405884, -0.405884, -0.405884, -0.405884, -0.405823, -0.405884, -0.405823, -0.405762, -0.405762, -0.405762, -0.405701, -0.405640, -0.405640, -0.405640, -0.405518, -0.405457, -0.405396, -0.405396, -0.405334, -0.405212, -0.405151, -0.405029, -0.405029, -0.404907, -0.404846, -0.404724, -0.404663, -0.404541, -0.404419, -0.404358, -0.404236, -0.404053, -0.403992, -0.403870, -0.403748, -0.403625, -0.403442, -0.403381, -0.403198, -0.403076, -0.402832, -0.402771, -0.402649, -0.402405, -0.402283, -0.402100, -0.401978, -0.401733, -0.401550, -0.401428, -0.401184, -0.401062, -0.400818, -0.400635, -0.400452, -0.400208, -0.400024, -0.399780, -0.399597, -0.399353, -0.399170, -0.398926, -0.398682, -0.398438, -0.398193, -0.397949, -0.397766, -0.397461, -0.397217, -0.396912, -0.396729, -0.396423, -0.396179, -0.395874, -0.395630, -0.395325, -0.395020, -0.394775, -0.394470, -0.394165, -0.393921, -0.393555, -0.393250, -0.392944, -0.392639, -0.392395, -0.391968, -0.391663, -0.391357, -0.391052, -0.390686, -0.390320, -0.390015, -0.389648, -0.389343, -0.388916, -0.388611, -0.388245, -0.387817, -0.387512, -0.387146, -0.386719, -0.386414, -0.385986, -0.385620, -0.385193, -0.384827, -0.384399, -0.384033, -0.383606, -0.383179, -0.382813, -0.382385, -0.381958, -0.381531, -0.381104, -0.380676, -0.380249, -0.379822, -0.379333, -0.378906, -0.378479, -0.378052, -0.377563, -0.377075, -0.376648, -0.376221, -0.375671, -0.375244, -0.374756, -0.374268, -0.373840, -0.373291, -0.372803, -0.372314, -0.371887, -0.371277, -0.370850, -0.370300, -0.369812, -0.369324, -0.368713, -0.368286, -0.367737, -0.367188, -0.366638, -0.366150, -0.365601, -0.364990, -0.364502, -0.363953, -0.363403, -0.362854, -0.362244, -0.361755, -0.361145, -0.360596, -0.359985, -0.359436, -0.358887, -0.358215, -0.357727, -0.357056, -0.356506, -0.355896, -0.355286, -0.354736, -0.354065, -0.353455, -0.352905, -0.352234, -0.351624, -0.351013, -0.350342, -0.349792, -0.349060, -0.348511, -0.347839, -0.347168, -0.346558, -0.345886, -0.345276, -0.344543, -0.343933, -0.343262, -0.342651, -0.341919, -0.341248, -0.340576, -0.339905, -0.339233, -0.338501, -0.337830, -0.337219, -0.336426, -0.335754, -0.335083, -0.334351, -0.333679, -0.332886, -0.332275, -0.331482, -0.330750, -0.330078, -0.329346, -0.328613, -0.327881, -0.327148, -0.326355, -0.325684, -0.324951, -0.324158, -0.323425, -0.322632, -0.321899, -0.321167, -0.320374, -0.319641, -0.318848, -0.318054, -0.317322, -0.316528, -0.315735, -0.314941, -0.314209, -0.313354, -0.312622, -0.311768, -0.310974, -0.310242, -0.309387, -0.308594, -0.307739, -0.306946, -0.306152, -0.305298, -0.304565, -0.303650, -0.302856, -0.302002, -0.301208, -0.300354, -0.299500, -0.298645, -0.297852, -0.296936, -0.296143, -0.295288, -0.294434, -0.293518, -0.292725, -0.291809, -0.290955, -0.290161, -0.289185, -0.288330, -0.287537, -0.286560, -0.285706, -0.284790, -0.283997, -0.283020, -0.282166, -0.281250, -0.280334, -0.279480, -0.278503, -0.277649, -0.276733, -0.275818, -0.274902, -0.273987, -0.273071, -0.272156, -0.271240, -0.270264, -0.269409, -0.268433, -0.267456, -0.266541, -0.265625, -0.264709, -0.263672, -0.262817, -0.261841, -0.260864, -0.259949, -0.258911, -0.258057, -0.257019, -0.256104, -0.255066, -0.254150, -0.253174, -0.252197, -0.251221, -0.250244, -0.249268, -0.248291, -0.247253, -0.246338, -0.245239, -0.244324, -0.243347, -0.242310, -0.241333, -0.240295, -0.239319, -0.238342, -0.237305, -0.236267, -0.235229, -0.234314, -0.233215, -0.232239, -0.231140, -0.230225, -0.229126, -0.228149, -0.227051, -0.226074, -0.224976, -0.223999, -0.222961, -0.221924, -0.220825, -0.219788, -0.218750, -0.217773, -0.216614, -0.215637, -0.214539, -0.213501, -0.212402, -0.211426, -0.210266, -0.209229, -0.208191, -0.207092, -0.205994, -0.205017, -0.203857, -0.202820, -0.201721, -0.200623, -0.199585, -0.198425, -0.197449, -0.196289, -0.195190, -0.194092, -0.193054, -0.191895, -0.190857, -0.189697, -0.188599, -0.187561, -0.186401, -0.185303, -0.184204, -0.183105, -0.181946, -0.180908, -0.179688, -0.178650, -0.177551, -0.176392, -0.175232, -0.174133, -0.173035, -0.171875, -0.170776, -0.169678, -0.168457, -0.167358, -0.166260, -0.165100, -0.163940, -0.162781, -0.161682, -0.160583, -0.159363, -0.158264, -0.157043, -0.156006, -0.154785, -0.153625, -0.152527, -0.151306, -0.150146, -0.149048, -0.147888, -0.146667, -0.145569, -0.144348, -0.143250, -0.142029, -0.140869, -0.139709, -0.138550, -0.137390, -0.136230, -0.134949, -0.133911, -0.132629, -0.131531, -0.130310, -0.129150, -0.127930, -0.126770, -0.125610, -0.124390, -0.123230, -0.122070, -0.120850, -0.119629, -0.118469, -0.117249, -0.116089, -0.114929, -0.113708, -0.112427, -0.111328, -0.110107, -0.108887, -0.107727, -0.106506, -0.105286, -0.104126, -0.102905, -0.101685, -0.100464, -0.099243, -0.098083, -0.096863, -0.095642, -0.094482, -0.093201, -0.092041, -0.090759, -0.089600, -0.088379, -0.087158, -0.085938, -0.084717, -0.083496, -0.082336, -0.081055, -0.079834, -0.078613, -0.077393, -0.076233, -0.074951, -0.073730, -0.072510, -0.071228, -0.070068, -0.068848, -0.067627, -0.066345, -0.065125, -0.063965, -0.062683, -0.061462, -0.060181, -0.059021, -0.057739, -0.056519, -0.055298, -0.054077, -0.052856, -0.051575, -0.050354, -0.049133, -0.047852, -0.046692, -0.045410, -0.044128, -0.042969, -0.041687, -0.040466, -0.039185, -0.038025, -0.036682, -0.035522, -0.034241, -0.033020, -0.031799, -0.030518, -0.029297, -0.028076, -0.026794, -0.025574, -0.024292, -0.023071, -0.021851, -0.020630, -0.019348, -0.018066, -0.016907, -0.015564, -0.014404, -0.013123, -0.011902, -0.010620, -0.009399, -0.008118, -0.006958, -0.005615, -0.004456, -0.003174, -0.001892, -0.000671, 0.000549, 0.001831, 0.003052, 0.004272, 0.005554, 0.006775, 0.008057, 0.009277, 0.010559, 0.011719, 0.013062, 0.014221, 0.015503, 0.016785, 0.018005, 0.019226, 0.020447, 0.021729, 0.023010, 0.024170, 0.025452, 0.026733, 0.027893, 0.029236, 0.030396, 0.031677, 0.032898, 0.034119, 0.035400, 0.036621, 0.037903, 0.039063, 0.040344, 0.041626, 0.042786, 0.044067, 0.045288, 0.046570, 0.047729, 0.049011, 0.050293, 0.051453, 0.052734, 0.053894, 0.055237, 0.056396, 0.057678, 0.058838, 0.060120, 0.061340, 0.062561, 0.063843, 0.065002, 0.066284, 0.067505, 0.068726, 0.069946, 0.071167, 0.072388, 0.073608, 0.074829, 0.076111, 0.077271, 0.078491, 0.079773, 0.080933, 0.082214, 0.083374, 0.084595, 0.085876, 0.087036, 0.088257, 0.089478, 0.090698, 0.091919, 0.093079, 0.094360, 0.095520, 0.096741, 0.097961, 0.099182, 0.100342, 0.101624, 0.102783, 0.104004, 0.105164, 0.106384, 0.107605, 0.108765, 0.110046, 0.111206, 0.112366, 0.113586, 0.114746, 0.116028, 0.117126, 0.118347, 0.119568, 0.120728, 0.121948, 0.123108, 0.124268, 0.125488, 0.126709, 0.127869, 0.128967, 0.130249, 0.131409, 0.132568, 0.133728, 0.134888, 0.136108, 0.137268, 0.138428, 0.139648, 0.140747, 0.141968, 0.143066, 0.144287, 0.145447, 0.146606, 0.147766, 0.148926, 0.150024, 0.151245, 0.152405, 0.153503, 0.154724, 0.155823, 0.156982, 0.158142, 0.159302, 0.160400, 0.161621, 0.162659, 0.163879, 0.164978, 0.166138, 0.167297, 0.168335, 0.169556, 0.170654, 0.171814, 0.172913, 0.174011, 0.175171, 0.176331, 0.177429, 0.178528, 0.179626, 0.180725, 0.181885, 0.183044, 0.184021, 0.185242, 0.186340, 0.187378, 0.188538, 0.189636, 0.190735, 0.191833, 0.192932, 0.193970, 0.195129, 0.196167, 0.197327, 0.198364, 0.199463, 0.200500, 0.201660, 0.202698, 0.203796, 0.204895, 0.205872, 0.207031, 0.208069, 0.209167, 0.210144, 0.211304, 0.212341, 0.213440, 0.214417, 0.215515, 0.216553, 0.217651, 0.218628, 0.219727, 0.220764, 0.221802, 0.222839, 0.223877, 0.224976, 0.225891, 0.227051, 0.228027, 0.229065, 0.230042, 0.231079, 0.232178, 0.233154, 0.234131, 0.235168, 0.236206, 0.237183, 0.238220, 0.239258, 0.240173, 0.241272, 0.242249, 0.243225, 0.244202, 0.245239, 0.246216, 0.247192, 0.248169, 0.249207, 0.250122, 0.251099, 0.252136, 0.253052, 0.254089, 0.255005, 0.255981, 0.256958, 0.257935, 0.258850, 0.259827, 0.260803, 0.261780, 0.262695, 0.263611, 0.264587, 0.265564, 0.266479, 0.267395, 0.268311, 0.269287, 0.270203, 0.271179, 0.272034, 0.272949, 0.273926, 0.274841, 0.275757, 0.276672, 0.277527, 0.278442, 0.279358, 0.280334, 0.281128, 0.282043, 0.283020, 0.283813, 0.284790, 0.285583, 0.286499, 0.287415, 0.288269, 0.289185, 0.289978, 0.290894, 0.291748, 0.292664, 0.293457, 0.294312, 0.295227, 0.296021, 0.296936, 0.297729, 0.298584, 0.299438, 0.300293, 0.301086, 0.302002, 0.302734, 0.303589, 0.304443, 0.305237, 0.306030, 0.306946, 0.307678, 0.308533, 0.309326, 0.310059, 0.310974, 0.311707, 0.312500, 0.313354, 0.314026, 0.314941, 0.315674, 0.316467, 0.317261, 0.317932, 0.318787, 0.319580, 0.320313, 0.321106, 0.321777, 0.322632, 0.323364, 0.324097, 0.324768, 0.325623, 0.326355, 0.327087, 0.327820, 0.328491, 0.329285, 0.330017, 0.330750, 0.331421, 0.332153, 0.332886, 0.333557, 0.334351, 0.334961, 0.335693, 0.336365, 0.337158, 0.337769, 0.338501, 0.339111, 0.339844, 0.340515, 0.341248, 0.341797, 0.342529, 0.343262, 0.343872, 0.344543, 0.345093, 0.345886, 0.346497, 0.347107, 0.347839, 0.348328, 0.349121, 0.349670, 0.350342, 0.350952, 0.351501, 0.352234, 0.352844, 0.353394, 0.354065, 0.354614, 0.355225, 0.355835, 0.356506, 0.356995, 0.357605, 0.358215, 0.358826, 0.359375, 0.359924, 0.360535, 0.361145, 0.361633, 0.362244, 0.362732, 0.363403, 0.363892, 0.364441, 0.365051, 0.365479, 0.366089, 0.366638, 0.367126, 0.367676, 0.368164, 0.368774, 0.369202, 0.369812, 0.370178, 0.370850, 0.371277, 0.371765, 0.372314, 0.372742, 0.373291, 0.373718, 0.374268, 0.374756, 0.375122, 0.375671, 0.376160, 0.376587, 0.377136, 0.377441, 0.377991, 0.378479, 0.378845, 0.379333, 0.379761, 0.380188, 0.380676, 0.381042, 0.381531, 0.381897, 0.382324, 0.382751, 0.383179, 0.383545, 0.383972, 0.384399, 0.384827, 0.385193, 0.385498, 0.385986, 0.386353, 0.386719, 0.387085, 0.387451, 0.387817, 0.388245, 0.388550, 0.388916, 0.389221, 0.389648, 0.390015, 0.390320, 0.390686, 0.390930, 0.391296, 0.391663, 0.392029, 0.392212, 0.392639, 0.392944, 0.393250, 0.393555, 0.393799, 0.394165, 0.394470, 0.394775, 0.395020, 0.395264, 0.395569, 0.395874, 0.396179, 0.396423, 0.396606, 0.396973, 0.397156, 0.397461, 0.397766, 0.397888, 0.398193, 0.398438, 0.398682, 0.398804, 0.399170, 0.399353, 0.399597, 0.399780, 0.399963, 0.400208, 0.400391, 0.400635, 0.400818, 0.401001, 0.401184, 0.401428, 0.401550, 0.401733, 0.401917, 0.402100, 0.402283, 0.402405, 0.402588, 0.402710, 0.402893, 0.403076, 0.403198, 0.403259, 0.403503, 0.403625, 0.403748, 0.403870, 0.403931, 0.404053, 0.404236, 0.404358, 0.404419, 0.404480, 0.404663, 0.404724, 0.404846, 0.404907, 0.404968, 0.405090, 0.405151, 0.405212, 0.405334, 0.405273, 0.405457, 0.405457, 0.405579, 0.405518, 0.405640, 0.405701, 0.405701, 0.405762, 0.405701, 0.405823, 0.405823, 0.405823, 0.405884, 0.405823, 0.405884, 0.430420};

void Chorus_SetSpeed(StereoChorus_t *ch, float I)
{
	float hz = I;
	hz*=hz;
	hz*=1.4f;
	ch->dphase = zOSF2I(((hz / ((float)ch->sr))*(float)(65536.f*65536.f)));
}

void Chorus_SetMix(StereoChorus_t *ch, float I)
{
	ch->mChorusMix = I;
}

void Chorus_SetShift(StereoChorus_t *ch,float I)
{
	ch->mChorusShift = (int)(2048.f*I/3.f)<<20;
};


void InitChorus(StereoChorus_t *ch)
{
	WaveGuide_Init(&ch->Line1);
	WaveGuide_Init(&ch->Line2);
	ch->sr = 44100;
	ch->mindelay = ch->sr * 0.018f;
	ch->chorusdepth = ch->sr * 0.003f;
	ch->phase = 0;
	ch->dphase = 0;
	ch->mindelayafterprocess = zOSF2I((ch->chorusdepth+ch->mindelay)*2);
	ch->mChorusMix = 0.5;
	ch->mChorusShift = 0;
	ch->monoIn = 1;
	Chorus_SetSpeed(ch, 0.4);
	Chorus_SetShift(ch, 1.0);

}




float getsin(unsigned int phase)
{
	unsigned int const p1 = (phase>>21)&2047;
	float const part = (float)(((phase<<11)>>11)/(float)(1<<21));
	return sintab[p1]+dsintab[p1]*part;
}



 void ProcessChorus(StereoChorus_t *ch,int32_t *in, int32_t *out)
{
	int nSamples = AUDIO_BUFFER_SIZE;


	float const nmix = 1-ch->mChorusMix;
	float const Mix = ch->mChorusMix * 65535.0f;
	unsigned int phase2 = ch->phase + ch->mChorusShift;
	while (nSamples--)
	{
		ch->phase+=ch->dphase;
		phase2+=ch->dphase;

		int32_t S1 = *in++;
		int32_t S2 = *in++;

		if (ch->monoIn) S1 = S2 = (S1 +S2)/2;

		WaveGuide_Push(&ch->Line1,S1);
		WaveGuide_Push(&ch->Line2,S2);
		unsigned int const p1 = (ch->phase>>21);
		unsigned int const p2 = (p1+2048/3)&2047;

		unsigned int const p4 = (phase2>>21);
		unsigned int const p5 = (p4+2048/3)&2047;
		float const part = (((ch->phase<<11)>>11)*(1.f/(float)(1<<21)));
		float const part2 = (((phase2<<11)>>11)*(1.f/(float)(1<<21)));

		float const delay1 = sintab[p1];//+dsintab[p1]*part;
		float const delay2 = sintab[p2];//+dsintab[p2]*part;
		float const delay4 = sintab[p4];//+dsintab[p4]*part2;
		float const delay5 = sintab[p5];//+dsintab[p5]*part2;

		float const l1 = WaveGuide_Get(&ch->Line1,delay1);
		float const l2 = WaveGuide_Get(&ch->Line1,delay2);
		float const l4 = WaveGuide_Get(&ch->Line2,delay4);
		float const l5 = WaveGuide_Get(&ch->Line2,delay5);


		*out++ = S1*nmix + (l1+l2)*Mix;
		*out++ = S2*nmix + (l4+l5)*Mix;
		/*unsigned int const p1 = (ch->phase>>21);
		unsigned int const p2 = (p1+2048/3)&2047;
		unsigned int const p3 = (p2+2048/3)&2047;

		unsigned int const p4 = (phase2>>21);
		unsigned int const p5 = (p4+2048/3)&2047;
		unsigned int const p6 = (p5+2048/3)&2047;

		float const part = (((ch->phase<<11)>>11)*(1.f/(float)(1<<21)));
		float const part2 = (((phase2<<11)>>11)*(1.f/(float)(1<<21)));

		float const delay1 = sintab[p1]+dsintab[p1]*part;
		float const delay2 = sintab[p2]+dsintab[p2]*part;
	//	float const delay3 = sintab[p3]+dsintab[p3]*part;

		float const delay4 = sintab[p4]+dsintab[p4]*part2;
		float const delay5 = sintab[p5]+dsintab[p5]*part2;
//		float const delay6 = sintab[p6]+dsintab[p6]*part2;

		float const l1 = WaveGuide_Get(&ch->Line1,delay1);
		float const l2 = WaveGuide_Get(&ch->Line1,delay2);
	//	float const l3 = WaveGuide_Get(&ch->Line1,delay3);
//		*out++ = S1 *nmix + (l1-l2-l3)*ch->mChorusMix;
		 *out++ = S1 *nmix + (l1-l2)*ch->mChorusMix;

		float const l4 = WaveGuide_Get(&ch->Line2,delay4);
		float const l5 = WaveGuide_Get(&ch->Line2,delay5);
	//	float const l6 = WaveGuide_Get(&ch->Line2,delay6);
		//*out++ = S2 *nmix + (l4-l5-l6)*ch->mChorusMix;
		 *out++ = S2 *nmix + (l4-l5)*ch->mChorusMix;*/
	}
}


